# Power BI

Embed and use Power BI dashboards in your web application to visualize and analyze data stored in Azure Data Explorer (ADX).

## Overview

Power BI is a powerful business analytics tool that enables you to create interactive visualizations and reports from your data. When integrated with Azure Data Explorer (ADX), Power BI provides a robust solution for understanding and representing large volumes of simulation data generated by the CosmoTech platform.

## Why Use Power BI with ADX?

The combination of Power BI and ADX offers several advantages:

- **Real-time Analytics** - Query and visualize large datasets stored in ADX with minimal latency
- **Interactive Dashboards** - Create dynamic, interactive reports that allow users to explore data through filtering and drill-down capabilities
- **Scalability** - Handle massive amounts of time-series and telemetry data efficiently
- **Custom Visualizations** - Build tailored charts, graphs, and KPIs specific to your simulation scenarios
- **Embedded Reports** - Seamlessly integrate Power BI reports directly into your web application

## Common Data Tables in ADX

The CosmoTech platform typically stores the following data in ADX:

- **ProbesMeasures** - Time-series data from simulation probes and measurements
- **ScenarioMetadata** - Information about scenarios (name, description, parameters)
- **ScenarioRun** - Execution details and results of scenario runs
- **ScenarioRunMetadata** - Metadata associated with each scenario run
- **SimulationTotalFacts** - Aggregated facts and metrics from simulations

## Creating Visualizations

### Basic Steps

1. **Import Data** - Connect to ADX and load relevant tables
2. **Transform Data** - Use Power Query Editor to clean and shape your data
3. **Create Relationships** - Define relationships between tables (e.g., linking runs to scenarios)
4. **Build Visuals** - Add charts, tables, and graphs to your report canvas
5. **Add Interactivity** - Configure filters, slicers, and drill-through actions
6. **Publish** - Publish your report to Power BI Service for sharing and embedding

### Example Visualizations

- **Line Charts** - Display time-series trends from ProbesMeasures
- **Bar Charts** - Compare metrics across different scenarios
- **KPI Cards** - Show key performance indicators at a glance
- **Tables** - Present detailed scenario parameters and results
- **Maps** - Visualize geographic data if applicable to your simulation

## Using KQL in Power BI

You can write Kusto Query Language (KQL) queries directly in Power BI to:

- Filter and aggregate data before importing
- Perform complex calculations and transformations
- Optimize query performance for large datasets

Example KQL query:
```kql
ProbesMeasures
| where SimulationRun == "run-123"
| summarize avg(Value) by bin(Timestamp, 1h), ProbeName
| order by Timestamp asc
```

## Embedding Reports in the Web Application

Power BI reports can be embedded directly into the CosmoTech web application:

1. **Publish to Power BI Service** - Upload your report to a Power BI workspace
2. **Configure Workspace** - Set up the workspace in your CosmoTech configuration
3. **Define Report Settings** - Specify display options, filters, and navigation preferences
4. **Apply Dynamic Filters** - Link report filters to scenario data for context-aware visualizations

The workspace configuration includes settings for:
- Report tags and display names
- Navigation pane options
- Filter pane visibility
- Dynamic filters based on scenario context

## Best Practices

- **Optimize Queries** - Use aggregations and filters to reduce data volume
- **Incremental Refresh** - Configure incremental refresh for large datasets
- **Limit Visuals** - Keep reports focused with a reasonable number of visualizations
- **Use Bookmarks** - Create bookmarks for different views and perspectives
- **Test Performance** - Ensure reports load quickly even with large datasets
- **Document Calculations** - Add descriptions to measures and calculated columns

## Dynamic Filtering

Power BI reports in the CosmoTech web application support dynamic filtering based on the current scenario context. This allows users to:

- Automatically view data relevant to the selected scenario
- Compare results across different scenario runs
- Filter by specific parameters or time ranges

Dynamic filters are configured in the workspace settings and can link Power BI report filters to scenario metadata stored in ADX.

## Troubleshooting

### Common Issues

- **Connection Errors** - Verify cluster URI and database name are correct
- **Authentication Failures** - Ensure proper permissions are set in ADX and Power BI
- **Slow Performance** - Optimize KQL queries and consider data aggregation
- **Empty Reports** - Check that data exists in ADX tables and queries are correct

### Performance Tips

- Use DirectQuery mode for real-time data or Import mode for better performance
- Create aggregation tables in ADX for frequently accessed metrics
- Limit the date range of data being queried
- Use materialized views in ADX for complex calculations

## Additional Resources

- [Power BI Documentation](https://docs.microsoft.com/power-bi/)
- [Azure Data Explorer Documentation](https://docs.microsoft.com/azure/data-explorer/)
- [KQL Query Language Reference](https://docs.microsoft.com/azure/data-explorer/kusto/query/)
